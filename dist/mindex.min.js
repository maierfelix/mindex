!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Mindex=e()}}(function(){return function e(t,n,i){function r(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return r(n?n:e)},f,f.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){function i(e,t){return-1!==r(e,t)}var r=e("./indexOf");t.exports=i},{"./indexOf":2}],2:[function(e,t,n){function i(e,t,n){if(n=n||0,null==e)return-1;for(var i=e.length,r=0>n?i+n:n;i>r;){if(e[r]===t)return r;r++}return-1}t.exports=i},{}],3:[function(e,t,n){function i(e,t,n){var i=e.length;t=null==t?0:0>t?Math.max(i+t,0):Math.min(t,i),n=null==n?i:0>n?Math.max(i+n,0):Math.min(n,i);for(var r=[];n>t;)r.push(e[t++]);return r}t.exports=i},{}],4:[function(e,t,n){function i(e){switch(l(e)){case"Object":return r(e);case"Array":return u(e);case"RegExp":return s(e);case"Date":return o(e);default:return e}}function r(e){return a(e)?f({},e):e}function s(e){var t="";return t+=e.multiline?"m":"",t+=e.global?"g":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)}function o(e){return new Date(+e)}function u(e){return e.slice()}var l=e("./kindOf"),a=e("./isPlainObject"),f=e("../object/mixIn");t.exports=i},{"../object/mixIn":10,"./isPlainObject":5,"./kindOf":6}],5:[function(e,t,n){function i(e){return!!e&&"object"==typeof e&&e.constructor===Object}t.exports=i},{}],6:[function(e,t,n){function i(e){return null===e?"Null":e===r?"Undefined":s.exec(o.call(e))[1]}var r,s=/^\[object (.*)\]$/,o=Object.prototype.toString;t.exports=i},{}],7:[function(e,t,n){function i(){u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=!0;for(var e in{toString:null})o=!1}function r(e,t,n){var r,a=0;null==o&&i();for(r in e)if(s(t,e,r,n)===!1)break;if(o)for(var f=e.constructor,c=!!f&&e===f.prototype;(r=u[a++])&&("constructor"===r&&(c||!l(e,r))||e[r]===Object.prototype[r]||s(t,e,r,n)!==!1););}function s(e,t,n,i){return e.call(i,t[n],n,t)}var o,u,l=e("./hasOwn");t.exports=r},{"./hasOwn":9}],8:[function(e,t,n){function i(e,t,n){s(e,function(i,s){return r(e,s)?t.call(n,e[s],s,e):void 0})}var r=e("./hasOwn"),s=e("./forIn");t.exports=i},{"./forIn":7,"./hasOwn":9}],9:[function(e,t,n){function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=i},{}],10:[function(e,t,n){function i(e,t){for(var n,i=0,o=arguments.length;++i<o;)n=arguments[i],null!=n&&s(n,r,e);return e}function r(e,t){this[t]=e}var s=e("./forOwn");t.exports=i},{"./forOwn":8}],11:[function(e,t,n){function i(e,t){var n="string"!=typeof arguments[1]?arguments[1]:r(arguments,1),i={};for(var o in e)e.hasOwnProperty(o)&&!s(n,o)&&(i[o]=e[o]);return i}var r=e("../array/slice"),s=e("../array/contains");t.exports=i},{"../array/contains":1,"../array/slice":3}],12:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){var e=arguments.length<=0||void 0===arguments[0]?e||[]:arguments[0],t=new c;if(t.isArray(e)===!1)throw new Error("fieldList must be an array.");return t.fieldList=e,t.isIndex=!0,t.clear(),t}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();n["default"]=s;var u=e("mout/lang/clone"),l=i(u),a=e("mout/object/omit"),f=i(a),c=function(){function e(t){return r(this,e),this.fieldList=[],this.values=[],this.keys=[],this.isIndex=!1,this.GE="<=",this.GT="<",this.LE=">=",this.LT=">",this}return o(e,[{key:"sort",value:function(e,t){return null===e&&null===t?0:null===e?-1:null===t?1:t>e?-1:e>t?1:0}},{key:"binarySearch",value:function(e,t){for(var n=0,i=e.length,r=0,s=0;i>n;){if(s=(n+i)/2<<0,r=this.sort(t,e[s]),0===r)return{found:!0,index:s};0>r?i=s:n=s+1}return{found:!1,index:i}}},{key:"isArray",value:function(e){return e instanceof Array}},{key:"concat",value:function(e,t){for(var n=0,i=t.length;i>n;)e.push(t[++n])}},{key:"insertAt",value:function(e,t,n){e.splice(t,0,n)}},{key:"removeAt",value:function(e,t){e.splice(t,1)}},{key:"clear",value:function(){this.values=[],this.keys=[]}},{key:"insertRecord",value:function(e){var t=this.fieldList.map(function(t){return e[t]||null});void 0===e.id&&this.set(t,e.id)}},{key:"removeRecord",value:function(e){var t=this.fieldList.map(function(t){return e[t]||null});this.remove(t,e.id)}},{key:"updateRecord",value:function(e){this.removeRecord(e),this.insertRecord(e)}},{key:"get",value:function(e){this.isArray(e)===!1&&(e=[e]);var t=e.shift()||null,n=this.binarySearch(this.keys,t);return 0===e.length?n.found===!0?this.values[n.index].isIndex===!0?this.values[n.index].getAll():this.values[n.index]:[]:n.found===!0?this.values[n.index].get(e):[]}},{key:"set",value:function(e,t){this.isArray(e)===!1&&(e=[e]);var n=e.shift()||null,i=this.binarySearch(this.keys,n);if(0===e.length)if(i.found===!0){var r=this.binarySearch(this.values[i.index],t);r.found===!1&&this.insertAt(this.values[i.index],r.index,t)}else this.insertAt(this.keys,i.index,n),this.insertAt(this.values,i.index,[t]);else if(i.found===!0)this.values[i.index].set(e,t);else{this.insertAt(this.keys,i.index,n);var o=s();o.set(e,t),this.insertAt(this.values,i.index,o)}}},{key:"getAll",value:function(){for(var e=[],t=null,n=0,i=this.values.length;i>n;++n)t=this.values[n],t.isIndex===!0?this.concat(e,t.getAll()):this.concat(e,t);return e}},{key:"query",value:function(e){var t=null,n=null;if(void 0!==e[this.GT]?(t=e[this.GT],e.leftInclusive=!1):void 0!==e[this.GE]&&(t=e[this.GE],e.leftInclusive=!0),void 0!==e[this.LT]?(n=e[this.LT],e.rightInclusive=!1):void 0!==e[this.LE]&&(n=e[this.LE],e.rightInclusive=!0),t.length!==n.length)throw new Error("Key arrays must be same length");return this.between(t,n,(0,f["default"])(e,[this.GT,this.GE,this.LT,this.LE]))}},{key:"remove",value:function(e,t){this.isArray(e)===!1&&(e=[e]);var n=e.shift(),i=this.binarySearch(this.keys,n);if(0===e.length){if(i.found===!0){var r=this.binarySearch(this.values[i.index],t);r.found===!0&&(this.removeAt(this.values[i.index],r.index),0===this.values[i.index].length&&(this.removeAt(this.keys,i.index),this.removeAt(this.values,i.index)))}}else i.found===!0&&this.values[i.index].remove(e,t)}},{key:"between",value:function(e,t,n){n=Object.assign({leftInclusive:!0,rightInclusive:!1,limit:0,offset:0},n);var i=this._between(e,t,n);return n.limit>0?i.slice(n.offset,n.limit+n.offset):i.slice(n.offset)}},{key:"_between",value:function(e,t,n){var i=[],r=e.shift(),s=t.shift(),o=null,u=n.limit>0;if(o=void 0!==r?this.binarySearch(this.keys,r):{found:!1,index:0},0===e.length){o.found===!1&&n.leftInclusive===!1&&o.index++;for(var a=o.index;a<this.keys.length;a+=1){if(void 0!==s)if(n.rightInclusive===!0){if(this.keys[a]>s)break}else if(this.keys[a]>=s)break;if(this.values[a].isIndex===!0?this.concat(i,this.values[a].getAll()):this.concat(i,this.values[a]),u===!0&&i.length>=n.limit+n.offset)break}}else for(var f=null,c=o.index;c<this.keys.length&&(f=this.keys[c],!(f>s))&&(this.values[c].isIndex===!0?f===r?i=i.concat(this.values[c]._between((0,l["default"])(e),t.map(function(){}),n)):f===s?i=i.concat(this.values[c]._between(e.map(function(){}),(0,l["default"])(t),n)):this.concat(i,this.values[c].getAll()):this.concat(i,this.values[c]),!(u===!0&&i.length>=n.limit+n.offset));c+=1);return u===!0?i.slice(0,n.limit+n.offset):i}}]),e}()},{"mout/lang/clone":4,"mout/object/omit":11}]},{},[12])(12)});
